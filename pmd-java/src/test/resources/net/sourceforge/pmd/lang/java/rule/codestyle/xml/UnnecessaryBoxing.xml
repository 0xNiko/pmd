<?xml version="1.0" encoding="UTF-8"?>
<test-data
    xmlns="http://pmd.sourceforge.net/rule-tests"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://pmd.sourceforge.net/rule-tests http://pmd.sourceforge.net/rule-tests_1_0_0.xsd">

    <test-code>
        <description>pos - new Integer(int)</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>2</expected-linenumbers>
        <code><![CDATA[
public class Foo {
    Integer i = new Integer(42);
}
        ]]></code>
    </test-code>

    <test-code>
        <description>neg - new Integer(String)</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
public class Foo {
    Integer i = new Integer("42");
}
        ]]></code>
    </test-code>

    <test-code>
        <description>neg - Integer.valueOf(String)</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
public class Foo {
    Integer i = Integer.valueOf("42");
}
        ]]></code>
    </test-code>

    <test-code>
        <description>pos - Integer.valueOf(int)</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>2</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit boxing</message>
        </expected-messages>
        <code><![CDATA[
public class Foo {
    Integer i = Integer.valueOf(42);
}
        ]]></code>
    </test-code>
    <test-code>
        <description>pos - new Integer(int)</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>2</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit boxing</message>
        </expected-messages>
        <code><![CDATA[
public class Foo {
    Integer i = new Integer(42);
}
        ]]></code>
    </test-code>
    <test-code>
        <description>pos - new Integer(int) with widening</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>3</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit conversion from char to Integer</message>
        </expected-messages>
        <code><![CDATA[
public class Foo {{
    char c = 0;
    Integer i = new Integer(c);
}}
        ]]></code>
    </test-code>
    <test-code>
        <description>pos - new Integer(int) assigned to object</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>3</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit boxing</message>
        </expected-messages>
        <code><![CDATA[
public class Foo {{
    char c = 0;
    Object obj = new Integer(2);
}}
        ]]></code>
    </test-code>
    <test-code>
        <description>pos - unboxing</description>
        <expected-problems>3</expected-problems>
        <expected-linenumbers>3,4,5</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit unboxing</message>
            <message>Unnecessary explicit conversion from Integer to double</message>
            <message>Unnecessary explicit conversion from Integer to double</message>
        </expected-messages>
        <code><![CDATA[
public class Foo {
    void fun(Integer c) {
        int i0 = c.intValue();
        double d = c.doubleValue();
        d = c.longValue();

    }
}
        ]]></code>
    </test-code>
    <test-code>
        <description>neg - unboxing to smaller type</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
public class Foo {
    void fun(Integer c) {
        byte i2 = c.byteValue();  // necessary
        short i = c.shortValue(); // necessary
        int i = c.byteValue();    // necessary, because it truncates the value before widening it.

    }
}
        ]]></code>
    </test-code>
    <test-code>
        <description>pos - unboxing to smaller type</description>
        <expected-problems>5</expected-problems>
        <expected-linenumbers>5,6,7,8,9</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit boxing</message>
            <message>Unnecessary explicit unboxing</message>
            <message>Unnecessary explicit unboxing</message>
            <message>Unnecessary explicit boxing</message>
            <message>Unnecessary boxing of boxed value</message>
        </expected-messages>
        <code><![CDATA[
            class Scratch {
                public static void main(String[] args) {
                    Integer integer = 2; // ok

                    Object a = Integer.valueOf(2);  // explicit boxing where the value would be autoboxed
                    int b = integer.intValue();     // explicit unboxing where the value would be auto-unboxed
                    Object c = integer.intValue();  // unboxing where the value is immediately reboxed
                    int i = Integer.valueOf(0);     // boxing where the value is immediately unboxed
                    Integer.valueOf(integer);       // boxing of already boxed value
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <!-- Casts are left to UnnecessaryCast -->
        <description>Unnecessary (primitive -> primitive) casts</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>5</expected-linenumbers>
        <expected-messages>
            <message>Unnecessary explicit boxing</message>
        </expected-messages>
        <code><![CDATA[
            class Scratch {
                public static void main(String[] args) {
                    Integer integer = 2; // ok

                    long a = (int) Integer.valueOf(2);  // explicit boxing where the value would be autoboxed
                    int b = (int) 2;                    // ignored, left to UnnecessaryCast
                    long c = (int) 4;                   // widening can be implicit
                    double c = (int) 4;                 // widening can be implicit
                    double c = (int) 4.0;               // cast is narrowing so necessary
                }
            }
        ]]></code>
    </test-code>
</test-data>
